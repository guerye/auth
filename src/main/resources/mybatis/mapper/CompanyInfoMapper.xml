<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wisdom.auth.provider.mapper.mapper.CompanyInfoMapper">
    <resultMap id="TrueBaseResultMap" type="com.wisdom.auth.provider.mapper.model.CompanyInfo">
        <id column="ID" jdbcType="INTEGER" property="id" />
        <result column="PARENT_ID" jdbcType="INTEGER" property="parentId" />
        <result column="COMPANY_ID" jdbcType="VARCHAR" property="companyId" />
        <result column="COMPANY_NAME" jdbcType="VARCHAR" property="companyName" />
        <result column="COMPANY_LEVEL" jdbcType="INTEGER" property="companyLevel" />
        <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate" />
        <result column="CLOSE_DATE" jdbcType="TIMESTAMP" property="closeDate" />
        <result column="REMARK" jdbcType="VARCHAR" property="remark" />
        <result column="STATUS" jdbcType="SMALLINT" property="status" />
    </resultMap>
    <resultMap id="BaseResultMap" type="com.wisdom.auth.provider.mapper.model.CompanyInfo">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="ID" jdbcType="INTEGER" property="id" />
        <result column="PARENT_ID" jdbcType="INTEGER" property="parentId" />
        <result column="COMPANY_ID" jdbcType="VARCHAR" property="companyId" />
        <result column="COMPANY_NAME" jdbcType="VARCHAR" property="title" />
        <result column="COMPANY_LEVEL" jdbcType="INTEGER" property="companyLevel" />
        <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate" />
        <result column="CLOSE_DATE" jdbcType="TIMESTAMP" property="closeDate" />
        <result column="REMARK" jdbcType="VARCHAR" property="remark" />
        <result column="STATUS" jdbcType="SMALLINT" property="status" />
    </resultMap>
    <resultMap id="companyMap" type="com.wisdom.auth.provider.mapper.model.CompanyInfo">
        <!--
          WARNING - @mbg.generated
        -->
        <id column="ID" jdbcType="INTEGER" property="id" />
        <result column="PARENT_ID" jdbcType="INTEGER" property="parentId" />
        <result column="COMPANY_ID" jdbcType="VARCHAR" property="companyId" />
        <result column="COMPANY_NAME" jdbcType="VARCHAR" property="title" />
        <result column="COMPANY_LEVEL" jdbcType="INTEGER" property="companyLevel" />
        <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate" />
        <result column="CLOSE_DATE" jdbcType="TIMESTAMP" property="closeDate" />
        <result column="REMARK" jdbcType="VARCHAR" property="remark" />
        <result column="STATUS" jdbcType="SMALLINT" property="status" />
        <collection  column="{ID=ID,USER_ID=USER_ID}" property="children" select="selectDeptsByParentId" />
    </resultMap>
    <resultMap id="companyTree" type="com.wisdom.auth.provider.mapper.model.CompanyInfo">
        <!--
          WARNING - @mbg.generated
        -->
        <id column="ID" jdbcType="INTEGER" property="id" />
        <result column="PARENT_ID" jdbcType="INTEGER" property="parentId" />
        <result column="COMPANY_ID" jdbcType="VARCHAR" property="companyId" />
        <result column="COMPANY_NAME" jdbcType="VARCHAR" property="title" />
        <result column="COMPANY_LEVEL" jdbcType="INTEGER" property="companyLevel" />
        <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate" />
        <result column="CLOSE_DATE" jdbcType="TIMESTAMP" property="closeDate" />
        <result column="REMARK" jdbcType="VARCHAR" property="remark" />
        <result column="STATUS" jdbcType="SMALLINT" property="status" />
        <collection  column="{ID=ID}" property="children" select="selectCompanyTreeByParentId" />
    </resultMap>

    <select id="findByWhere"  resultMap="TrueBaseResultMap" >
        select ID,PARENT_ID,COMPANY_ID,COMPANY_NAME,COMPANY_LEVEL,CREATE_DATE,CLOSE_DATE,REMARK,STATUS,SORT_NO from COMPANY_INFO
        <where>
            <if test="id !=null">
                and ID = #{id}
            </if>
            <if test="parentId !=null">
                and PARENT_ID = #{parentId}
            </if>
            <if test="companyId !=null">
                and COMPANY_ID = #{companyId}
            </if>
            <if test="companyIdLike !=null">
                and COMPANY_ID LIKE CONCAT(#{companyIdLike},'%')
            </if>
            <if test="companyIdList != null and companyIdList.size > 0">
                and COMPANY_ID in
                <foreach item="item" index="index" collection="companyIdList" open="("
                         separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="companyName !=null">
                and COMPANY_NAME = #{companyName}
            </if>
            <if test="companyLevel !=null">
                and COMPANY_LEVEL = #{companyLevel}
            </if>
            <if test="createDate !=null">
                and CREATE_DATE = #{createDate}
            </if>
            <if test="closeDate !=null">
                and CLOSE_DATE = #{closeDate}
            </if>
            <if test="remark !=null">
                and REMARK = #{remark}
            </if>
            <if test="status !=null">
                and STATUS = #{status}
            </if>
            <if test="sortNo !=null">
                and SORT_NO = #{sortNo}
            </if>
        </where>
    </select>

    <select id="selectCompanyTree" resultMap="companyTree">
        SELECT * FROM COMPANY_INFO
        <where>
            <if test="id == 0">
                PARENT_ID =0
            </if>
            <if test="id >0">
                PARENT_ID = #{id}
            </if>
        </where>
    </select>

        <select id="selectCompanyTreeByParentId" resultMap="companyTree">
    SELECT * FROM COMPANY_INFO
    WHERE PARENT_ID = #{ID}
  </select>
    <select id="selectCompanyDrop" resultMap="BaseResultMap">
        SELECT * FROM DEPT_INFO
        <where>
            1=1
            and STATUS=1
            <if test="companyLevel!=null and companyLevel!=''">
                and COMPANY_LEVEL=#{deptLevel}
            </if>

            <if test="parentId!=null and parentId!=''">
                and PARENT_ID=#{parentId}
            </if>

        </where>
    </select>
    <select id="findCompanyIdMapByDomain"  resultType="java.util.Map" useCache="true">
        select
        COMPANY_ID as 'key' ,COMPANY_NAME as 'value'
        from
        COMPANY_INFO
        <where>
            <if test="id !=null">
                and ID = #{id}
            </if>
        </where>
    </select>
    <select id="findIdMapByDomain"  resultType="java.util.Map" useCache="true">
        select
        ID as 'key' ,COMPANY_NAME as 'value'
        from
        COMPANY_INFO
        <where>
            <if test="id !=null">
                and ID = #{id}
            </if>
        </where>
    </select>
</mapper>